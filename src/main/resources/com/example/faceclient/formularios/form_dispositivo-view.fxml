<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.CheckBox?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.TitledPane?>
<?import javafx.scene.control.Tooltip?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.FlowPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Pane?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.shape.Rectangle?>

<!-- Manter esse janela com  prefHeight="650.0" prefWidth="800.0" -->

<ScrollPane fx:id="root" fitToWidth="true" prefHeight="650.0" prefWidth="800.0" xmlns="http://javafx.com/javafx/23.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.example.faceclient.controller.FormDispositivoController">
    <content>
        <VBox spacing="12" style="-fx-background-color: #f6f7fb; -fx-padding: 16;">

            <!-- Título -->
            <Label style="-fx-font-size: 18px; -fx-font-weight: bold;" text="Cadastro e Teste de Dispositivos" />

            <!-- ======================= Registro de Câmera IP ======================= -->
            <TitledPane expanded="true" text="Registro de Câmera IP">
                <content>
                    <VBox spacing="10">
                        <padding>
                            <Insets bottom="12" left="12" right="12" top="12" />
                        </padding>

                        <!-- Linha: Endereço IP -->
                        <HBox alignment="CENTER_LEFT" spacing="8">
                            <Label minWidth="150" text="Camera" />
                            <ComboBox fx:id="cameraCombo" prefWidth="400" promptText="Selecione a câmera..." />
                            <Button fx:id="ipHelpBtn" prefWidth="32" style="-fx-font-weight: bold;" text="!" />
                        </HBox>

                        <!-- Linha: Nome do Dispositivo -->
                        <HBox alignment="CENTER_LEFT" spacing="8">
                            <Label minWidth="150" text="Nome" />
                            <TextField fx:id="cameraNameField" prefWidth="400" promptText="Dê um nome para identificar a câmera (ex.: Portaria 1)" />
                        </HBox>

                        <!-- Pré-visualização + Controles -->
                        <HBox alignment="CENTER_LEFT" spacing="12">
                            <!-- Usar esse StackPane com o OpenCV (ImageView) -->
                            <StackPane fx:id="videoPane" prefHeight="320" prefWidth="560" style="-fx-background-color: #111; -fx-border-color: #333; -fx-border-radius: 8; -fx-background-radius: 8;">
                                <ImageView fx:id="cameraView" fitHeight="320" fitWidth="560" preserveRatio="true" />
                                <!-- Overlay para ROI -->
                                <Pane fx:id="overlay" pickOnBounds="true">
                                    <Rectangle fx:id="roiRect" fill="#00BFFF33" stroke="deepskyblue" strokeWidth="2" visible="false" />
                                </Pane>
                            </StackPane>

                            <!-- Controles PTZ e Teste -->
                            <VBox alignment="CENTER" spacing="8">
                                <Button fx:id="cameraBtn" onAction="#onConectarCamera" prefHeight="52.0" prefWidth="100.0" text="Ativar Camera" />
                        <Region prefHeight="25.0" prefWidth="153.0" />
                                <Label fx:id="cameraStatusLabel" style="-fx-text-fill: #777;"/>
                            </VBox>
                        </HBox>
                    </VBox>
                </content>
            </TitledPane>

            <!-- ======================= Registro de Arduino ======================== -->
            <TitledPane expanded="true" text="Registro do Microcontrolador">
                <content>
                    <VBox spacing="10">
                        <padding>
                            <Insets bottom="12" left="12" right="12" top="12" />
                        </padding>

                        <!-- Código de Identificação -->
                        <HBox alignment="CENTER_LEFT" spacing="8">
                            <Label  text="Endereço IP" />
                            <TextField fx:id="arduinoIpField" prefWidth="180" promptText="Ex: 192.168.0.10"/>
                            <!-- Porta -->
                            <Label text="Porta"/>
                            <TextField fx:id="arduinoPortField" prefWidth="90" promptText="Ex: 8080"/>

                            <Button fx:id="arduinoHelpBtn" prefWidth="32" style="-fx-font-weight: bold;" text="!" />
                        </HBox>
                        <HBox alignment="CENTER_LEFT" spacing="8">
                            <children>
                                <Button fx:id="arduinoHelpBtn11" onAction="#onConectarArduino" prefHeight="25.0" prefWidth="117.0" text="Conectar Arduino" />
                                <Label fx:id="arduinoStatusLabel" style="-fx-text-fill: #777;" text="Aguardando teste..." />
                            </children>
                        </HBox>

                        <!-- Chips de permissões adicionadas -->
                        <FlowPane fx:id="permContainer" hgap="6" prefWrapLength="560" vgap="6" />
                    </VBox>
                </content>
            </TitledPane>

            <!-- ======================= Rodapé: Ações ============================== -->
            <HBox alignment="CENTER_RIGHT" spacing="8">
                <padding>
                    <Insets bottom="0" left="0" right="0" top="6" />
                </padding>
            <Label fx:id="validarFormSalvar" style="-fx-text-fill: #777;" text="Preencha todos os campos ..." visible="false" />

                <Region HBox.hgrow="ALWAYS" /> <!-- empurra botões para a direita -->

                <Button fx:id="saveBtn" defaultButton="true" minWidth="96" onAction="#onSalvar" text="Salvar">
                    <tooltip>
                        <Tooltip text="Salvar alterações (Ctrl+S)" />
                    </tooltip>
                </Button>

                <Button fx:id="canceleBtn" cancelButton="true" minWidth="96" onAction="#onCancelar" style="-fx-background-color: #f8d7da; -fx-text-fill: #8a1c24; -fx-font-weight: bold;" text="Cancelar">
                    <tooltip>
                        <Tooltip text="Cancelar registro atual" />
                    </tooltip>
                </Button>

                <Button fx:id="deleteBtn" minWidth="96" style="-fx-background-color: #f8d7da; -fx-text-fill: #8a1c24;" text="Deletar">
                    <tooltip>
                        <Tooltip text="Excluir registro atual (Del)" />
                    </tooltip>
                </Button>
            </HBox>

        </VBox>
    </content>
</ScrollPane>
